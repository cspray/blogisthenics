#!/usr/bin/env php
<?php declare(strict_types=1);

use Cspray\AnnotatedContainer\Cli\CommandExecutor;
use Cspray\AnnotatedContainer\Cli\InputParser;
use Cspray\AnnotatedContainer\Cli\TerminalOutput;
use Cspray\Blogisthenics\Bootstrap\Bootstrap;
use Cspray\Blogisthenics\Cli\BuildCommand;

if (php_sapi_name() !== 'cli') {
    exit('The blogisthenics CLI tool is not meant to run in non-cli SAPI.');
}

$rootDir = $blogRoot = dirname(__DIR__);
if (!file_exists($rootDir . '/vendor/autoload.php')) {
    $rootDir = dirname(__DIR__, 4);
}
require $rootDir . '/vendor/autoload.php';

$container = Bootstrap::bootstrap(
    $rootDir,
    ['default', 'cli']
);

$executor = new CommandExecutor();

$executor->addCommand($container->get(BuildCommand::class));

exit($executor->execute(
    (new InputParser())->parse($argv),
    new TerminalOutput()
));